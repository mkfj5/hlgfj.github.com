<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Coding: Game Class Functionality</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>Search in Multiagent Domains</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Lesson Plan - Week 8.html">01. Lesson Plan - Week 8</a>
    </li>
    <li class="">
      <a href="02. Overview .html">02. Overview </a>
    </li>
    <li class="">
      <a href="03. The Minimax Algorithm.html">03. The Minimax Algorithm</a>
    </li>
    <li class="">
      <a href="04. Isolation.html">04. Isolation</a>
    </li>
    <li class="">
      <a href="05. Building a Game Tree.html">05. Building a Game Tree</a>
    </li>
    <li class="">
      <a href="06. Coding Building a Game Class.html">06. Coding: Building a Game Class</a>
    </li>
    <li class="">
      <a href="07. Which of These Are Valid Moves.html">07. Which of These Are Valid Moves?</a>
    </li>
    <li class="">
      <a href="08. Coding Game Class Functionality.html">08. Coding: Game Class Functionality</a>
    </li>
    <li class="">
      <a href="09. Building a Game Tree (Contd.).html">09. Building a Game Tree (Contd.)</a>
    </li>
    <li class="">
      <a href="10. Isolation Game Tree with Leaf Values.html">10. Isolation Game Tree with Leaf Values</a>
    </li>
    <li class="">
      <a href="11. How Do We Tell the Computer Not to Lose.html">11. How Do We Tell the Computer Not to Lose?</a>
    </li>
    <li class="">
      <a href="12. MIN and MAX Levels.html">12. MIN and MAX Levels</a>
    </li>
    <li class="">
      <a href="13. Coding Scoring Min &amp; Max Levels.html">13. Coding: Scoring Min &amp; Max Levels</a>
    </li>
    <li class="">
      <a href="14. Propagating Values Up the Tree.html">14. Propagating Values Up the Tree</a>
    </li>
    <li class="">
      <a href="15. Computing MIN MAX Values.html">15. Computing MIN MAX Values</a>
    </li>
    <li class="">
      <a href="16. Computing MIN MAX Solution.html">16. Computing MIN MAX Solution</a>
    </li>
    <li class="">
      <a href="17. Choosing the Best Branch.html">17. Choosing the Best Branch</a>
    </li>
    <li class="">
      <a href="18. Coding Minimax Search.html">18. Coding: Minimax Search</a>
    </li>
    <li class="">
      <a href="19. Max Number of Nodes Visited.html">19. Max Number of Nodes Visited</a>
    </li>
    <li class="">
      <a href="20. Max Moves.html">20. Max Moves</a>
    </li>
    <li class="">
      <a href="21. The Branching Factor.html">21. The Branching Factor</a>
    </li>
    <li class="">
      <a href="22. Number of Nodes in a Game Tree.html">22. Number of Nodes in a Game Tree</a>
    </li>
    <li class="">
      <a href="23. The Branching Factor (Contd.).html">23. The Branching Factor (Contd.)</a>
    </li>
    <li class="">
      <a href="24. Max Number of Nodes.html">24. Max Number of Nodes</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">08. Coding: Game Class Functionality</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3></h3>
  <div>
  <h2 id="-adding-functionality-to-the-game-class">## Adding Functionality to the Game Class</h2>
<p>We will use the interface for adversarial search problems defined in Chapter 5.1 of Artificial Intelligence: a Modern Approach, which includes the following five functions:</p>
<ul>
<li><code>player()</code>: return the active player in the current state</li>
<li><code>actions()</code>: return a list of the legal actions in the current state</li>
<li><code>result(action)</code>: return a new state that results from applying the given action in the current state</li>
<li><code>terminal_test()</code>: return True if the current state is terminal, and False otherwise</li>
<li><code>utility(player)</code>: return +inf if the game is terminal and the specified player wins, return -inf if the game is terminal and the specified player loses, and return 0 if the game is not terminal (<strong>NOTE:</strong> You do <strong>not</strong> need to implement this function now)</li>
</ul>
<p>We will extend that interface with one additional domain specific method, which will simplify implementing several techniques later in the lesson:</p>
<ul>
<li><code>liberties(loc)</code>: return a list of cells in the neighborhood of the specified location that are open</li>
</ul>
<p>Implement these functions for your game class below. If you get stuck, flip over to the solution to see one possible implementation.</p>
<p><em>Note: Don't be afraid to add additional functions to the class or module to help complete the two required tasks.</em></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>

  <h4>Start Quiz:</h4>
  <div>
  <div class="nav nav-tabs nav-fill" role="tablist" id="question-tabs">
    <a href="#624484-gamestate-py" class="nav-item nav-link  active show" id="tab-624484-gamestate-py" data-toggle="tab" role="tab"
      aria-controls="624484-gamestate-py" aria-selected="true">gamestate.py</a>
    <a href="#624484-testcode-py" class="nav-item nav-link " id="tab-624484-testcode-py" data-toggle="tab" role="tab"
      aria-controls="624484-testcode-py" aria-selected="false">testcode.py</a>
    <a href="#624484-solution-py" class="nav-item nav-link " id="tab-624484-solution-py" data-toggle="tab" role="tab"
      aria-controls="624484-solution-py" aria-selected="false">solution.py</a>
  </div>

  <div class="tab-content" style="padding: 20px 0;" id="question-tab-contents">
    <div class="tab-pane  active show" id="624484-gamestate-py" aria-labelledby="tab-624484-gamestate-py" role="tabpanel">
      <pre><code></code>
class GameState:
    &quot;&quot;&quot;
    Attributes
    ----------
    TODO: Copy in your implementation from the previous quiz
    &quot;&quot;&quot;
    def __init__(self):
        # TODO: Copy in your implementation from the previous quiz
        pass
        
    def actions(self):
        &quot;&quot;&quot; Return a list of legal actions for the active player 
        
        You are free to choose any convention to represent actions,
        but one option is to represent actions by the (row, column)
        of the endpoint for the token. For example, if your token is
        in (0, 0), and your opponent is in (1, 0) then the legal
        actions could be encoded as (0, 1) and (0, 2).
        &quot;&quot;&quot;
        # TODO: Finish this function!
        pass
    
    def player(self):
        &quot;&quot;&quot; Return the id of the active player 
        
        Hint: return 0 for the first player, and 1 for the second player
        &quot;&quot;&quot;
        # TODO: Finish this function!
        pass
    
    def result(self, action):
        &quot;&quot;&quot; Return a new state that results from applying the given
        action in the current state
        
        Hint: Check out the deepcopy module--do NOT modify the
        objects internal state in place
        &quot;&quot;&quot;
        # TODO: Finish this function!
        pass
    
    def terminal_test(self):
        &quot;&quot;&quot; return True if the current state is terminal,
        and False otherwise
        
        Hint: an Isolation state is terminal if _either_
        player has no remaining liberties (even if the
        player is not active in the current state)
        &quot;&quot;&quot;
        # TODO: Finish this function!
        pass
    
    def liberties(self, loc):
        &quot;&quot;&quot; Return a list of all open cells in the
        neighborhood of the specified location.  The list 
        should include all open spaces in a straight line
        along any row, column or diagonal from the current
        position. (Tokens CANNOT move through obstacles
        or blocked squares in queens Isolation.)
        
        Note: if loc is None, then return all empty cells
        on the board
        &quot;&quot;&quot;
        # TODO: Finish this function!
        pass
</code></pre>
    </div>
    <div class="tab-pane " id="624484-testcode-py" aria-labelledby="tab-624484-testcode-py" role="tabpanel">
      <pre><code></code>
from gamestate import *

print(&quot;Creating empty game board...&quot;)
g &#x3D; GameState()

print(&quot;Checking active player on an empty board...&quot;)
if g.player() !&#x3D; 0:
    print(&quot;Failed\n Uh Oh! Your game did not return player &quot; +
          &quot;id 0 on an empty board.&quot;)
else:
    print(&quot;Passed.&quot;)

print(&quot;Checking terminal test on an empty board...&quot;)
if g.terminal_test() !&#x3D; False:
    print(&quot;Failed\n Uh Oh! Your game marked an empty game state as terminal.&quot;)
else:
    print(&quot;Passed.&quot;)
    
print(&quot;Checking liberties on an empty board...&quot;)
p1_liberties &#x3D; g.liberties(None)
if len(p1_liberties) !&#x3D; 5:
    print(&quot;Failed\n Uh oh! Your game did not return 5 empty &quot; +
          &quot;cell locations as liberties on an empty board.&quot;)
else:
    print(&quot;Passed.&quot;)

print(&quot;Getting legal moves for player 1...&quot;)
p1_empty_moves &#x3D; g.actions()
print(&quot;Found {} legal moves.&quot;.format(len(p1_empty_moves or [])))

print(&quot;Applying move {} for player 1...&quot;.format(p1_empty_moves[0]))
g1 &#x3D; g.result(p1_empty_moves[0])

print(&quot;Getting legal moves for player 2...&quot;)
p2_empty_moves &#x3D; g1.actions()
if len(p2_empty_moves) !&#x3D; 4:
    print(&quot;Failed\n  Uh oh! Your game did not return the expected &quot; +
          &quot;number of actions for player 2!&quot;)
else:
    print(&quot;Passed.&quot;)

print(&quot;\nPlaying a full game&quot;)
for _ in range(5):
    if g.terminal_test(): break
    g &#x3D; g.result(g.actions()[0])

print(&quot;Checking terminal test on a terminal board...&quot;)
if g.terminal_test() !&#x3D; True:
    print(&quot;Failed\n  Uh oh! Your game did not correctly evalute &quot; +
          &quot;a terminal game state as terminal!&quot;)
else:
    print(&quot;Passed.&quot;)
</code></pre>
    </div>
    <div class="tab-pane " id="624484-solution-py" aria-labelledby="tab-624484-solution-py" role="tabpanel">
      <pre><code></code>
from copy import deepcopy

xlim, ylim &#x3D; 3, 2  # board dimensions

# The eight movement directions possible for a chess queen
RAYS &#x3D; [(1, 0), (1, -1), (0, -1), (-1, -1),
        (-1, 0), (-1, 1), (0, 1), (1, 1)]


class GameState:
    &quot;&quot;&quot;
    Attributes
    ----------
    _board: list(list)
        Represent the board with a 2d array _board[x][y]
        where open spaces are 0 and closed spaces are 1
    
    _parity: bool
        Keep track of active player initiative (which
        player has control to move) where 0 indicates that
        player one has initiative and 1 indicates player 2
    
    _player_locations: list(tuple)
        Keep track of the current location of each player
        on the board where position is encoded by the
        board indices of their last move, e.g., [(0, 0), (1, 0)]
        means player 1 is at (0, 0) and player 2 is at (1, 0)
    &quot;&quot;&quot;
    def __init__(self):
        self._board &#x3D; [[0] * ylim for _ in range(xlim)]
        self._board[-1][-1] &#x3D; 1  # block lower-right corner
        self._parity &#x3D; 0
        self._player_locations &#x3D; [None, None]
        
    def actions(self):
        &quot;&quot;&quot; Return a list of legal actions for the active player &quot;&quot;&quot;
        return self.liberties(self._player_locations[self._parity])
    
    def player(self):
        &quot;&quot;&quot; Return the id of the active player &quot;&quot;&quot;
        return self._parity
    
    def result(self, action):
        &quot;&quot;&quot; Return a new state that results from applying the given
        action in the current state
        &quot;&quot;&quot;
        assert action in self.actions(), &quot;Attempted forecast of illegal move&quot;
        newBoard &#x3D; deepcopy(self)
        newBoard._board[action[0]][action[1]] &#x3D; 1
        newBoard._player_locations[self._parity] &#x3D; action
        newBoard._parity ^&#x3D; 1
        return newBoard
    
    def terminal_test(self):
        &quot;&quot;&quot; return True if the current state is terminal,
        and False otherwise
        
        Hint: an Isolation state is terminal if _either_
        player has no remaining liberties (even if the
        player is not active in the current state)
        &quot;&quot;&quot;
        return (not self._has_liberties(self._parity)
            or not self._has_liberties(1 - self._parity))
    
    def liberties(self, loc):
        &quot;&quot;&quot; Return a list of all open cells in the
        neighborhood of the specified location.  The list 
        should include all open spaces in a straight line
        along any row, column or diagonal from the current
        position. (Tokens CANNOT move through obstacles
        or blocked squares in queens Isolation.)
        &quot;&quot;&quot;
        if loc is None: return self._get_blank_spaces()
        moves &#x3D; []
        for dx, dy in RAYS:  # check each movement direction
            _x, _y &#x3D; loc
            while 0 &lt;&#x3D; _x + dx &lt; xlim and 0 &lt;&#x3D; _y + dy &lt; ylim:
                _x, _y &#x3D; _x + dx, _y + dy
                if self._board[_x][_y]:  # stop at any blocked cell
                    break
                moves.append((_x, _y))
        return moves
    
    def _has_liberties(self, player_id):
        &quot;&quot;&quot; Check to see if the specified player has any liberties &quot;&quot;&quot;
        return any(self.liberties(self._player_locations[player_id]))

    def _get_blank_spaces(self):
        &quot;&quot;&quot; Return a list of blank spaces on the board.&quot;&quot;&quot;
        return [(x, y) for y in range(ylim) for x in range(xlim)
                if self._board[x][y] &#x3D;&#x3D; 0]
</code></pre>
    </div>
  </div>
</div>



</div>


  <div class="jumbotron" style="margin-top: 50px; margin-bottom: 50px;">
    <h3>INSTRUCTOR NOTE:</h3>
    <p>The example solution is intended to be simple to reason about; it is not designed for high performance. Returning copies of the game state when forecasting moves has significant overhead (especially in Python), and returning a complete list of all legal moves is inefficient (a generator would be better), but both conventions simplify the underlying implementation &amp; interface for the minimax algorithm. We will use a similar interface in the project.</p>
<p>When performance matters, it is typical to use <a href="https://en.wikipedia.org/wiki/Bitboard" rel="noopener noreferrer" target="_blank">bitboards</a> (which <em>are</em> used in the project library). </p>
  </div>
</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="09. Building a Game Tree (Contd.).html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('08. Coding: Game Class Functionality')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
